\section{Explained through Baseball}

\begin{frame}
 \frametitle{Replica di dati nel cloud}
 \begin{itemize}
   \item Sistemi di cloud storage replicano i dati su più macchine per la resistenza ai guasti e performance.
   \item Si utilizza la geo-replication per resistere ad una eventuale perdita di datacenter interi.
   \item I datacenter vengono distribuita a livello globale in più continenti per garantire che i dati siano vicini a più basi di client.
 \end{itemize}
  
\end{frame}

\begin{frame}
 \frametitle{Sistemi di storage popolari}
Attualmente i cloud storage systems scelgono fra la strong consistency e eventual consistency:
 \begin{itemize}
   \item Amazon S3 – eventual consistency
   \item Amazon Simple DB – eventual o strong
   \item Google App Engine – strong o eventual
   \item Yahoo! PNUTS – eventual o strong
   \item Windows Azure Storage – strong o eventual
 \end{itemize}
%Amazon ha spinto sulla eventual consistency, ma offre la strong consistency come opzione per servizi, come SimpleDB e DynamoDB.
%Google App Engine ha cominciato offrendo solo strong consistency, ma dopo ha aggiunto delle opzioni di lettura, weakly consistent data per quelle applicazioni che richiedono maggiori performance.
%Yahoo!’s PNUTS system, la tencologia di base per molti dei servizi offerti da Yahoo, offre sia eventual consistency e strong consistency.
%Windows Azure fornisce solo la strong consistency, anche se utilizza l'eventual consistency per i dati geo-replicati.
\end{frame}

\begin{frame}
\frametitle{Teorema CAP (Teorema di Bremer)}
	\begin{definizione}
	 Il \alert{teorema CAP} afferma che è impossibile per un sistema informatico distribuito fornire simultaneamente tutte e tre le seguenti garanzie:
	\begin{itemize}
		\item Coerenza\\
		tutti i nodi vedono gli stessi dati nello stesso momento
		\item Disponibilità\\
	    la garanzia che ogni richiesta riceva una risposta su ciò che sia riuscito o fallito
		\item Tolleranza di partizione\\
		il sistema continua a funzionare nonostante arbitrarie perdite di messaggi
	\end{itemize}
	Secondo il teorema, un sistema distribuito è in grado di soddisfare al massimo due di queste garanzie allo stesso tempo, ma non tutte e tre
	\end{definizione}
\end{frame}

\begin{frame}
\frametitle{Alcuni tipi di consistenza}
\begin{enumerate}
  \item \textbf{Strong Consistency}: garantisce che l'operazione di lettura ritorni il valore dell'ultima scrittura.
  \item \textbf{Eventual Consistency}: è la più debole delle altre, poiché permette di avere come valore di ritorno il più grande insieme di possibilità.
  \item \textbf{Consistent Prefix}: osserva l'ordine di sequenza delle scritture e ritorna l'ultima.
  \item \textbf{Bounded Staleness}: assicura che il risultato della lettura non sia scaduto, ovvero per ogni dato definisce un periodo di tempo $T$ 'staleness' e garantisce che l'operazione di lettura ritorni un qualsiasi valore scritto fra $T$ e il più recente.
  \item \textbf{Monotonic Reads}: si possono leggere dati vecchi, ovvero se il client effettua la lettura di un dato ed ottiene un certo valore $X$ è garantito che se rilegge non riceverà un dato che è stato scritto prima di $X$. 
  \item \textbf{Read My Writes}: gli effetti di tutte le scritture che sono state fatte da un client, sono visibili al client successivo che legge quei dati.
\end{enumerate}
\end{frame}

\begin{frame}
\frametitle{Consistenze a confronto}
	\begin{figure}
		\includegraphics[scale=0.5]{baseball/tab2.jpg}
	\end{figure}
\end{frame}

\begin{frame}[fragile]
\frametitle{Il baseball in pseudocodice}
\begin{lstlisting}
 Write ("visitors", 0);
 Write ("home", 0);
   for inning = 1 .. 9
     outs = 0;
     while outs < 3
       visiting player bats;
       for each run scored
         score = Read ("visitors");
         Write ("visitors", score + 1);
     outs = 0;
     while outs < 3
       home player bats;
       for each run scored
         score = Read ("home");
         Write ("home", score + 1);
 end game;
\end{lstlisting}
\end{frame}

\begin{frame}
\frametitle{Un esempio}
	\begin{figure}
		\includegraphics[scale=0.4]{baseball/tab3a.jpg}\\
		\includegraphics[scale=0.4]{baseball/tab3.jpg}
	\end{figure}
\end{frame}

\begin{frame}
 \frametitle{Soggetti del baseball}
 Nel gioco del baseball vi sono differenti soggetti con diversi ruoli, ognuno di essi necessita di un modello di consistenza:\\
 \begin{itemize}
   \item Segnapunti
   \item Arbitro
   \item Radiocronista
   \item Giornalista sportivo
   \item Statistico
   \item Osservatore
 \end{itemize}
\end{frame}

\begin{frame}[fragile]
 \frametitle{Segnapunti}
  \begin{lstlisting}
    score = Read ("visitors");
    Write ("visitors", score + 1);
  \end{lstlisting}
  \begin{block}{Consistenza desiderata}
    \begin{itemize}
      \item Strong consistency è superflua, il segnapunti è l'unico ad effettuare delle write.
      \item Read My Writes è sufficiente.
    \end{itemize}     
  \end{block}
\end{frame}

\begin{frame}[fragile]
 \frametitle{Arbitro}
  \begin{lstlisting}
    if first half of 9th inning complete then
      vScore = Read ("visitors");
      hScore = Read ("home");
      if vScore < hScore
        end game;
  \end{lstlisting}
 \begin{block}{Consistenza desiderata}
   L'arbitro necessita della Strong Consistency per determinare la squadra vincitrice e concludere la partita.
 \end{block}
\end{frame}

\begin{frame}[fragile]
 \frametitle{Radiocronista}
  \begin{lstlisting}
    do {
        vScore = Read ("visitors");
        hScore = Read ("home");
        report vScore and hScore;
        sleep (30 minutes);
    }
  \end{lstlisting}
  \begin{block}{Consistenza desiderata}
    \begin{itemize}
      \item Consistent Prefix non è sufficiente, la lettura successiva può avvenire su un nodo non sincronizzato.
      Esempio: dopo aver letto lo score 2-5  è possibile leggere il punteggio 1-3.
      \item Monotonic Reads 
      \item Bounded Staleness è necessaria 
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}[fragile]
 \frametitle{Giornalista sportivo}
  \begin{lstlisting}
    While not end of game {
      drink beer;
      smoke cigar;
    }
    go out to dinner;
    vScore = Read ("visitors");
    hScore = Read ("home");
    write article;
  \end{lstlisting}
  \begin{block}{Consistenza desiderata}
    
  \end{block}
\end{frame}

\begin{frame}[fragile]
 \frametitle{Statistico}
  \begin{lstlisting}
    Wait for end of game;
    score = Read ("home");
    stat = Read ("season-runs");
    Write ("season-runs", stat + score);
  \end{lstlisting}
  \begin{block}{Consistenza desiderata}
   
   \end{block}
\end{frame}

\begin{frame}[fragile]
 \frametitle{Osservatore}
  \begin{lstlisting}
    do {
        stat = Read ("season-runs");
        discuss stats with friends;
        sleep (1 day);
    }
  \end{lstlisting}
  \begin{block}{Consistenza desiderata}
   
  \end{block}
\end{frame}